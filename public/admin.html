<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è–º–∏</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üëë</text></svg>">
    <link rel="stylesheet" href="/css/app.min.css">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h1>
        <div class="user-info">
            <div class="user-badge" id="user-badge">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <a href="/" class="back-btn">‚Üê –ö —Å–ø–∏—Å–∫—É</a>
        </div>
    </div>

    <nav class="main-nav">
        <a href="/" class="nav-link">üìã –ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏</a>
        <a href="/visitors.html" class="nav-link">‚ûï –î–æ–±–∞–≤–∏—Ç—å</a>
        <a href="/events.html" class="nav-link">üéØ –°–æ–±—ã—Ç–∏—è</a>
        <a href="/scanner.html" class="nav-link">üì± –°–∫–∞–Ω–µ—Ä</a>
        <a href="/stats.html" class="nav-link">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
        <a href="/admin.html" class="nav-link active">üëë –ê–¥–º–∏–Ω</a>
    </nav>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
    <div class="page-actions">
        <button onclick="admin.showCreateUserForm()" class="primary-btn" id="create-user-btn">
            üë§ –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        </button>
        <button onclick="admin.refreshUsers()" class="secondary-btn">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
        </button>
        <button onclick="admin.showSystemInfo()" class="secondary-btn">
            üìä –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        </button>
        <button onclick="admin.exportData()" class="secondary-btn">
            üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        </button>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="filters-section">
        <select id="role-filter">
            <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
            <option value="admin">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</option>
            <option value="moderator">‚öôÔ∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã</option>
            <option value="skd">üîí –°–ö–î</option>
        </select>
        <select id="active-filter">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="true">‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ</option>
            <option value="false">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
        </select>
        <button onclick="admin.filterUsers()" class="secondary-btn">üîç –ù–∞–π—Ç–∏</button>
        <button onclick="admin.resetFilters()" class="secondary-btn">üîÑ –°–±—Ä–æ—Å</button>
    </div>

    <!-- –°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-section">
        <h3>üìà –°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <div class="stats-grid" id="system-stats">
            <div class="stat-card">
                <div class="stat-number" id="total-users">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="active-users">0</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-sessions">0</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="system-uptime">0</div>
                <div class="stat-label">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã (—á)</div>
            </div>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="table-container">
        <div class="table-header">
            <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã</span>
            <span id="users-count">0</span>
        </div>
        <div id="users-table">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>
        </div>
    </div>

    <div id="users-pagination" class="pagination hidden"></div>

    <!-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã -->
    <div class="stats-section">
        <h3>üñ•Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã</h3>
        <div class="system-monitoring" id="system-monitoring">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ...</div>
        </div>
    </div>

    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ -->
    <div class="stats-section">
        <h3>üîê –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏</h3>
        <div id="active-sessions">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π...</div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div id="create-user-modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üë§ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <button onclick="admin.hideCreateUserForm()" class="close-btn">‚úï</button>
        </div>

        <form id="user-form">
            <div class="form-group">
                <label for="username">–õ–æ–≥–∏–Ω *</label>
                <input name="username" id="username" placeholder="user123" required pattern="[a-zA-Z0-9_]{3,50}">
                <small class="form-hint">–û—Ç 3 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤. –¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –∑–Ω–∞–∫ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è</small>
            </div>

            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å *</label>
                <input name="password" id="password" type="password" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required minlength="6">
                <small class="form-hint">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</small>
            </div>

            <div class="form-group">
                <label for="fullName">–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                <input name="fullName" id="fullName" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" required>
            </div>

            <div class="form-group">
                <label for="role">–†–æ–ª—å *</label>
                <select name="role" id="role" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                    <option value="admin">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    <option value="moderator">‚öôÔ∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
                    <option value="skd">üîí –°–ö–î</option>
                </select>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input name="email" id="email" type="email" placeholder="user@example.com">
                <small class="form-hint">–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</small>
            </div>

            <div class="modal-actions">
                <button type="submit" class="primary-btn">
                    <span class="btn-text">‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
                    <span class="btn-loading hidden">üîÑ –°–æ–∑–¥–∞–Ω–∏–µ...</span>
                </button>
                <button type="button" onclick="admin.hideCreateUserForm()" class="secondary-btn">
                    ‚ùå –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div id="edit-user-modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <button onclick="admin.hideEditUserForm()" class="close-btn">‚úï</button>
        </div>

        <form id="edit-user-form">
            <input type="hidden" id="edit-user-id">

            <div class="form-group">
                <label for="edit-username">–õ–æ–≥–∏–Ω</label>
                <input id="edit-username" readonly style="background: #f8f9fa; color: #666;">
                <small class="form-hint">–õ–æ–≥–∏–Ω –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å</small>
            </div>

            <div class="form-group">
                <label for="edit-fullName">–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                <input name="fullName" id="edit-fullName" required>
            </div>

            <div class="form-group">
                <label for="edit-role">–†–æ–ª—å *</label>
                <select name="role" id="edit-role" required>
                    <option value="admin">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    <option value="moderator">‚öôÔ∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
                    <option value="skd">üîí –°–ö–î</option>
                </select>
            </div>

            <div class="form-group">
                <label for="edit-email">Email</label>
                <input name="email" id="edit-email" type="email">
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input name="isActive" id="edit-isActive" type="checkbox">
                    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω
                </label>
            </div>

            <div class="modal-actions">
                <button type="submit" class="primary-btn">
                    <span class="btn-text">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
                    <span class="btn-loading hidden">üîÑ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>
                </button>
                <button type="button" onclick="admin.hideEditUserForm()" class="secondary-btn">
                    ‚ùå –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
<div id="system-info-modal" class="modal hidden">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3>üìä –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <button onclick="admin.hideSystemInfo()" class="close-btn">‚úï</button>
        </div>

        <div id="system-info-content" style="padding: 25px;">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</div>
        </div>

        <div class="modal-actions">
            <button onclick="admin.refreshSystemInfo()" class="secondary-btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            <button onclick="admin.hideSystemInfo()" class="secondary-btn">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
<script src="/js/utils.js"></script>
<script src="/js/auth.js"></script>
<script src="/js/admin.js"></script>
<script src="/js/app.js"></script>

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', async () => {
        if (await auth.check()) {
            if (!auth.hasRole(['admin'])) {
                utils.showAlert('error', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞');
                window.location.href = '/';
                return;
            }
            await admin.init();
        }
    });
</script>
<script src="/js/responsive-tables.js"></script>
</body>
</html>