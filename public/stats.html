<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è–º–∏</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <link rel="stylesheet" href="/css/app.min.css">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h1>
        <div class="user-info">
            <div class="user-badge" id="user-badge">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <a href="/" class="back-btn">‚Üê –ö —Å–ø–∏—Å–∫—É</a>
        </div>
    </div>

    <nav class="main-nav">
        <a href="/" class="nav-link">üìã –ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏</a>
        <a href="/visitors.html" class="nav-link">‚ûï –î–æ–±–∞–≤–∏—Ç—å</a>
        <a href="/events.html" class="nav-link">üéØ –°–æ–±—ã—Ç–∏—è</a>
        <a href="/scanner.html" class="nav-link">üì± –°–∫–∞–Ω–µ—Ä</a>
        <a href="/stats.html" class="nav-link active">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
    </nav>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π -->
    <div class="stats-controls">
        <button onclick="stats.refresh()" class="primary-btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <button onclick="stats.exportStats()" class="secondary-btn" id="export-btn">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
        <select id="period-select" onchange="stats.changePeriod()">
            <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
            <option value="week" selected>–ù–µ–¥–µ–ª—è</option>
            <option value="month">–ú–µ—Å—è—Ü</option>
            <option value="all">–í—Å–µ –≤—Ä–µ–º—è</option>
        </select>
    </div>

    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-overview">
        <h2>üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div class="stats-grid" id="overview-stats">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
            <div class="stat-card">
                <div class="stat-number" id="total-visitors">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="active-visitors">0</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="today-scans">0</div>
                <div class="stat-label">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-scans">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</div>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ–±—ã—Ç–∏—è–º -->
    <div class="stats-section">
        <h3>üéØ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ–±—ã—Ç–∏—è–º</h3>
        <div class="table-container">
            <table id="events-stats-table">
                <thead>
                <tr>
                    <th>–°–æ–±—ã—Ç–∏–µ</th>
                    <th>–ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏</th>
                    <th>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</th>
                    <th>–°–µ–≥–æ–¥–Ω—è</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td colspan="5" class="loading-cell">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º -->
    <div class="stats-section">
        <h3>üìÖ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</h3>
        <div class="daily-stats" id="daily-stats">
            <!-- –ü—Ä–æ—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤–º–µ—Å—Ç–æ –≥—Ä–∞—Ñ–∏–∫–∞ -->
            <div class="table-container">
                <table id="daily-activity-table">
                    <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</th>
                        <th>–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏</th>
                        <th>–ü–µ—Ä–≤—ã–µ –≤–∏–∑–∏—Ç—ã</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="4" class="loading-cell">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ–≥–æ–¥–Ω—è) -->
    <div class="stats-section" id="hourly-stats-section">
        <h3>üïê –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º (—Å–µ–≥–æ–¥–Ω—è)</h3>
        <div class="hourly-stats">
            <div class="table-container">
                <table id="hourly-activity-table">
                    <thead>
                    <tr>
                        <th>–ß–∞—Å</th>
                        <th>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</th>
                        <th>–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="3" class="loading-cell">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- –¢–æ–ø –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π -->
    <div class="stats-section">
        <h3>üëë –¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π</h3>
        <div class="table-container">
            <table id="top-visitors-table">
                <thead>
                <tr>
                    <th>#</th>
                    <th>–§–ò–û</th>
                    <th>–°–æ–±—ã—Ç–∏–µ</th>
                    <th>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</th>
                    <th>–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td colspan="5" class="loading-cell">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- –°–≤–æ–¥–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π -->
    <div class="stats-section">
        <h3>üì± –¢–∏–ø—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
        <div class="scan-types-stats">
            <div class="stats-grid">
                <div class="stat-detail-card">
                    <h4>üÜï –ü–µ—Ä–≤—ã–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
                    <div class="stat-number" id="first-scans">0</div>
                    <small>–ù–æ–≤—ã–µ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏</small>
                </div>
                <div class="stat-detail-card">
                    <h4>üîÑ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
                    <div class="stat-number" id="repeat-scans">0</div>
                    <small>–í–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ—Å—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏</small>
                </div>
                <div class="stat-detail-card">
                    <h4>‚ö†Ô∏è –î—É–±–ª–∏–∫–∞—Ç—ã</h4>
                    <div class="stat-number" id="duplicate-scans">0</div>
                    <small>–ë—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–µ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</small>
                </div>
                <div class="stat-detail-card">
                    <h4>üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</h4>
                    <div class="stat-number" id="blocked-attempts">0</div>
                    <small>–ü–æ–ø—ã—Ç–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</small>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
    <div class="stats-section">
        <h3>üïí –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
        <div class="recent-activity" id="recent-activity">
            <div class="activity-list">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π...</div>
            </div>
        </div>
    </div>

    <!-- –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
    <div class="update-info">
        <small>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="last-update">-</span></small>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
<script src="/js/utils.js"></script>
<script src="/js/auth.js"></script>
<script src="/js/stats.js"></script>
<script src="/js/app.js"></script>

<script>
    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    let autoRefreshInterval;

    function startAutoRefresh() {
        autoRefreshInterval = setInterval(() => {
            if (document.visibilityState === 'visible') {
                stats.refreshQuietly(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–æ–∫–∞–∑–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
            }
        }, 30000);
    }

    function stopAutoRefresh() {
        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
            autoRefreshInterval = null;
        }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', () => {
        startAutoRefresh();
    });

    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'hidden') {
            stopAutoRefresh();
        } else {
            startAutoRefresh();
        }
    });

    // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('beforeunload', () => {
        stopAutoRefresh();
    });
</script>
</body>
</html>