<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è–º–∏</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üë•</text></svg>">
    <link rel="stylesheet" href="/css/app.min.css">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è</h1>
        <div class="user-info">
            <div class="user-badge" id="user-badge">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <a href="/" class="back-btn">‚Üê –ö —Å–ø–∏—Å–∫—É</a>
        </div>
    </div>

    <nav class="main-nav">
        <a href="/" class="nav-link">üìã –ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏</a>
        <a href="/visitors.html" class="nav-link active">‚ûï –î–æ–±–∞–≤–∏—Ç—å</a>
        <a href="/events.html" class="nav-link">üéØ –°–æ–±—ã—Ç–∏—è</a>
        <a href="/scanner.html" class="nav-link">üì± –°–∫–∞–Ω–µ—Ä</a>
        <a href="/stats.html" class="nav-link">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
        <a href="/admin.html" class="nav-link" id="admin-nav" style="display: none;">üëë –ê–¥–º–∏–Ω</a>
    </nav>

    <div class="form-container">
        <form id="visitor-form" enctype="multipart/form-data">
            <div class="form-section">
                <h3>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

                <div class="form-group">
                    <label for="eventId">–°–æ–±—ã—Ç–∏–µ *</label>
                    <select name="eventId" id="eventId" required>
                        <option value="">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="lastName">–§–∞–º–∏–ª–∏—è *</label>
                        <input name="lastName" id="lastName" placeholder="–ò–≤–∞–Ω–æ–≤" required>
                    </div>
                    <div class="form-group">
                        <label for="firstName">–ò–º—è *</label>
                        <input name="firstName" id="firstName" placeholder="–ò–≤–∞–Ω" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="middleName">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                    <input name="middleName" id="middleName" placeholder="–ò–≤–∞–Ω–æ–≤–∏—á">
                </div>

                <div class="form-group">
                    <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea name="comment" id="comment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ" rows="3"></textarea>
                </div>
            </div>

            <div class="form-section">
                <h3>üìä –®—Ç—Ä–∏—Ö–∫–æ–¥</h3>

                <div class="form-group">
                    <label for="barcode">–®—Ç—Ä–∏—Ö–∫–æ–¥ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input name="barcode" id="barcode" placeholder="–ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏" pattern="[A-Z0-9\-_]+">
                    <small class="form-hint">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è.</small>
                    <button type="button" onclick="visitors.generateBarcode()" class="secondary-btn">üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>

            <div class="form-section">
                <h3>üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</h3>

                <div class="form-group">
                    <label for="photo">–§–æ—Ç–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è</label>
                    <input type="file" name="photo" id="photo" accept="image/*">
                    <small class="form-hint">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF</small>
                </div>

                <div id="photo-preview" class="photo-preview hidden">
                    <img id="preview-image" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ">
                    <button type="button" onclick="visitors.removePhoto()" class="remove-photo">‚úï</button>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="primary-btn">
                    <span class="btn-text">‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è</span>
                    <span class="btn-loading hidden">üîÑ –°–æ–∑–¥–∞–Ω–∏–µ...</span>
                </button>
                <button type="button" onclick="visitors.resetForm()" class="secondary-btn">üîÑ –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
            </div>
        </form>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è -->
        <div id="creation-result" class="creation-result hidden">
            <div class="success-card">
                <h3>üéâ –ü–æ—Å–µ—Ç–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!</h3>
                <div id="visitor-info"></div>

                <div class="qr-container">
                    <h4>üì± QR-–∫–æ–¥ –¥–ª—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è:</h4>
                    <canvas id="qr-canvas"></canvas>
                    <div class="qr-actions">
                        <button onclick="visitors.downloadQR()" class="primary-btn">üì• –°–∫–∞—á–∞—Ç—å QR-–∫–æ–¥</button>
                        <button onclick="visitors.printQR()" class="secondary-btn">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                    </div>
                </div>

                <div class="next-actions">
                    <button onclick="visitors.createAnother()" class="primary-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ</button>
                    <a href="/" class="secondary-btn">üìã –ö —Å–ø–∏—Å–∫—É –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/auth.js"></script>
<script src="/js/visitors.js"></script>
<script src="/js/app.js"></script>

<script>
    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ
    document.getElementById('photo').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            if (file.size > 5 * 1024 * 1024) {
                utils.showAlert('error', '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º 5MB.');
                e.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('photo-preview');
                const img = document.getElementById('preview-image');
                img.src = e.target.result;
                preview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
    });

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —à—Ç—Ä–∏—Ö–∫–æ–¥–∞
    document.getElementById('barcode').addEventListener('input', function(e) {
        const value = e.target.value.toUpperCase();
        e.target.value = value;

        if (value && !utils.validateBarcode(value)) {
            e.target.setCustomValidity('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —à—Ç—Ä–∏—Ö–∫–æ–¥–∞');
        } else {
            e.target.setCustomValidity('');
        }
    });
</script>
<script src="/js/responsive-tables.js"></script>
</body>
</html>